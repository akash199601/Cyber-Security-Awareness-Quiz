{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Employee KYC Verification</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: Arial, sans-serif; }
    body { display: flex; height: 100vh; background: #f4f4f4; }
    .sidebar {
      width: 200px;
      background: #2C3E50;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    .sidebar img { width: 200px; margin-bottom: 20px; }
    .nav-button {
      width: 100%;
      padding: 12px;
      margin-bottom: 10px;
      background: #34495E;
      color: white;
      text-align: center;
      border: none;
      cursor: pointer;
      font-size: 16px;
      transition: 0.3s;
    }
    .nav-button:hover, .nav-button.active { background: #1ABC9C; }
    .main-container { flex: 1; padding: 20px; overflow-y: auto; }
    header { background: #4a90e2; padding: 10px; text-align: center; color: #fff; margin-bottom: 20px; }
    .content-container { gap: 20px; }
    .table-container { 
        flex: 2; 
        background: white; 
        padding: 15px; 
        border-radius: 8px; 
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        margin-bottom: 20px;
        position: relative; 
        overflow-y:scroll;
        height: 300px;
    }
    .image-preview-container {
      background: white; padding: 15px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .filters {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
      justify-content: right;
    }
    select {
      padding: 8px;
      width: 150px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px; border: 1px solid #ddd; text-align: center; }
    th { background-color: #68ad9a; }
    tr:nth-child(even) { background: #fafafa; }
    tr:hover { background-color: #d1ecf1; cursor: pointer; }
    button {
      padding: 8px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }
    .yes-btn { color: black; }
    .no-btn { color: black; }
    .image-item { text-align: center;margin: 5px;height: 100px; }
    .image-item img {
      width: 150px;
      height: 80px;
      cursor: pointer;
      transition: transform 0.3s;
    }
   
    .info-item{
        display:flex;
        margin-bottom:5px;
    }
    
    tbody , tr,td{
        /*padding: 4px;*/
        font-size: small;
    }

    /* Full-Screen Zoom Modal */
.modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.8);
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
}

.modal-content {
    max-width: 80%;
    max-height: 80%;
    transform: rotate(0deg) scale(1);
    transition: transform 0.2s ease-in-out;
}
/* Close Button */
.close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: white;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
}

#rotateButton {
    margin-top: 10px;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    background-color: #fff;
    border: none;
    border-radius: 5px;
}

  </style>

  <style>
    .documents-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
    }
    .document-box {
        width: 25%;
        height: 150px;
        text-align: center;
        border: 1px solid #ccc;
        padding: 10px;
        box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
    }
    .verify-btn {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 10px;
    }

</style>
  <style>
    .table thead {
        background-color: #2c7d59;
        color: white;
        text-align: center;
    }
    .table th, .table td {
        vertical-align: middle;
        text-align: center;
    }
    .verify-btn {
        display: flex;
        gap: 10px;
        justify-content: center;
    }
    .yes-btn {
    
        color: black;
        border: none;
        padding: 5px 15px;
        border-radius: 5px;
    }
    .no-btn {
    
        color: black;
        border: none;
        padding: 5px 15px;
        border-radius: 5px;
    }
    .section-title {
        font-size: 22px;
        font-weight: bold;
        text-align: center;
        margin-top: 20px;
        color: #333;
    }
    .highlight {
        color: #d63384;
        font-weight: bold;
    }

 
    .highlight-yes {
        background-color: green !important;
        color: white !important;
        border: 1px solid darkgreen !important;
    }
    
    .highlight-no {
        background-color: red !important;
        color: white !important;
        border: 1px solid darkred !important;
    }
    
</style>

<style>
    #overlay-loader {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 9999;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    #overlay-loader span {
        font-size: 20px;
        font-weight: bold;
        color: white;
        background: black;
        padding: 10px 20px;
        border-radius: 5px;
    }
</style>    

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    
<script>
  function goToReports() {
      window.location.href = "/reports/";  // âœ… Replace with your actual page URL
  }
</script>

<script>
    function goToHelpdesk() {
        window.location.href = "/helpdesk/";  // Replace with your actual Helpdesk page URL
    }
</script>

{% comment %} // filter by emp id {% endcomment %}
<script>
    function filterByEmpId() {
        // Get the entered Employee ID
        const empId = document.getElementById("filterEmpId").value.trim();

        // Get all rows from the table
        const rows = document.querySelectorAll("#pendingemployeeTableBody tr");

        // Loop through rows and hide/show based on Employee ID
        rows.forEach(row => {
            const rowEmpId = row.querySelector("td:nth-child(2)").textContent.trim(); // Get Employee ID from the second column
            if (empId === "" || rowEmpId.includes(empId)) {
                row.style.display = ""; // Show row
            } else {
                row.style.display = "none"; // Hide row
            }
        });
    }

    function resetFilter() {
        // Clear the input field
        document.getElementById("filterEmpId").value = "";

        // Show all rows
        const rows = document.querySelectorAll("#pendingemployeeTableBody tr");
        rows.forEach(row => {
            row.style.display = ""; // Show row
        });
    }
</script>


</head>
<body>
  <div class="sidebar">
    <img src="{% static 'logo.png' %}" alt="Company Logo">
    <h3>HR Dashboard</h3>
    <button class="nav-button active">Verification</button>
    <button class="nav-button" onclick="goToReports()">Reports</button>
    <button class="nav-button" onclick="goToHelpdesk()">Helpdesk</button>
    <button class="nav-button"><a href="{% url 'logout' %}" style="color:white;">Logout</a></button>

  </div>

  <div class="main-container">
    <div style="height: 30px;padding-top: 5px;margin-bottom: 10px;padding-left: 5px;">  
        <span style="color: #e92691;font-weight: 600;margin-right:20px;">Emp ID  : {{hr_employee_id}}</span>
        <span style="color: #e92691;font-weight: 600;margin-right:20px;">Name : {{hr_employee.name}}</span>
        <span style="color: #e92691;font-weight: 600;margin-right:20px;">Unit Name : {{employee_unitname.0}}</span>
    </div>
    <header><h3>Employee KYC Verification</h3></header>

    <button style="color:white;background:blue;" onclick="runStoredProcedure()">Sync Data</button>
  
    <div class="content-container">

        <div id="overlay-loader">
            <span>Loading...</span>
        </div>

        <h3 class="text-center section-title">Pending Data (<span style="color:red;">{{pending_employee_count}}</span>)</h3>
        <div class="filters" style="text-align: center; margin-bottom: 20px;">
            <input type="text" id="filterEmpId" placeholder="Enter Employee ID" style="padding: 8px; width: 200px; border-radius: 5px; border: 1px solid #ccc;">
            <button onclick="filterByEmpId()" style="padding: 8px 15px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">Filter</button>
            <button onclick="resetFilter()" style="padding: 8px 15px; background-color: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;">Reset</button>
        </div>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>S/N</th>
                        <th>Emp ID</th>
                        <th>Mobile</th>
                        <th>AADHAR</th>
                        <th>PAN</th>
                        <th>DOB</th>
                        {% comment %} <th>Verify</th> {% endcomment %}
                    </tr>
                </thead>
                <tbody id="pendingemployeeTableBody">
                    {% for emp in employee_details %}
                    <tr class="employee-row" data-id="{{ emp.employee_id }}">
                        <td>{{ forloop.counter }}</td>
                        <td>{{ emp.employee_id }}</td>
                        <td>{{ emp.MobileNo }}</td>
                        <td>{{ emp.AdhaarNo }}</td>
                        <td>{{ emp.PAN_Number }}</td>
                        <td>{{ emp.DOB }}</td>
                    </tr>
                    {% endfor %}

                </tbody>
            </table>
        </div>
    
        <h3 class="text-center section-title">Verification Section</h3>
        <div class="image-preview-container">
            <div class="basic-details" style="width:100%;">
            
                <div class="basic-detials-first" style="display:flex;padding: 5px;background-color: aliceblue;height: 30px;">
                    <div class="basic-details-content" style="width: 25%;font-size: smaller;">
                        <p><strong style="color: #e92691;">Zone:</strong> <span class="zonename"></span></p>
                    </div>
                    <div class="basic-details-content" style="width: 25%;font-size: smaller;">
                        <p><strong style="color: #e92691;">Division:</strong> <span class="divisionname"></span></p>
                    </div>
                    <div class="basic-details-content" style="width: 25%;font-size: smaller;">
                        <p><strong style="color: #e92691;">Region:</strong> <span class="regionname"></span></p>
                    </div>
                    <div class="basic-details-content" style="width: 25%;font-size: smaller;">
                        <p><strong style="color: #e92691;">Unit :</strong> <span class="unitname"></span></p>
                    </div>
                </div>
                <div class="basic-detials-second" style="display:flex;padding: 5px;background-color: aliceblue;height: 30px;">
                    
                    <div class="basic-details-content" style="width: 25%;font-size: smaller;">
                        <p><strong style="color: #e92691;">Staff ID:</strong> <span class="staffid"></span></p>
                    </div>
                    <div class="basic-details-content" style="width: 25%;font-size: smaller;">
                        <p><strong style="color: #e92691;">Name:</strong> <span class="staffname"></span></p>
                    </div>
                    <div class="basic-details-content" style="width: 25%;font-size: smaller;">
                        <p><strong style="color: #e92691;">Mobile No :</strong> <span class="empmobile"></span></p>
                    </div>
                    <div class="basic-details-content" style="width: 25%;font-size: smaller;">
                        <p><strong style="color: #e92691;">DOJ:</strong> <span class="doj"></span></p>
                    </div>               
                </div>
                
            </div>
            <br>
            <h3 class="text-center section-title">Aadhar Verification Data</h3>
            <div class="basic-details" style="width:100%;">
    
                <div class="basic-detials-first" style="display:flex;padding: 5px;background-color: aliceblue;height: 30px;">
                    <div class="basic-details-content" style="width: 25%;font-size: smaller;">
                        <p><strong style="color: #e92691;">Name:</strong> <span class="signdesk_name"></span></p>
                    </div>
                    <div class="basic-details-content" style="width: 25%;font-size: smaller;">
                        <p><strong style="color: #e92691;">Care of:</strong> <span class="care_of"></span></p>
                    </div>
                    <div class="basic-details-content" style="width: 25%;font-size: smaller;">
                        <p><strong style="color: #e92691;">District:</strong> <span class="district"></span></p>
                    </div>
                    <div class="basic-details-content" style="width: 25%;font-size: smaller;">
                        <p><strong style="color: #e92691;">House No. :</strong> <span class="house_no"></span></p>
                    </div>
                </div>
            </div>
    
            <br>

            <div class="basic-details" style="width:100%;display:flex;">           
                <table class="table table-bordered mt-3" style="width:48%;height: 300px;margin-right: 4%;">
                    <thead>
                        <tr>
                            <th>Emp ID</th>
                            <th>User Input</th>
                            <th>System Data</th>
                            <th>SignDesk Verification</th>
                            <th>Verify</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td rowspan="4"><span class="staffid"></span></td>
                            <td><strong class="highlight">DOB</strong><br><span class="dob"></span></td>
                            <td><strong class="highlight">DOB</strong><br><span class="empdob"></span></td>
                            <td><strong class="highlight">DOB</strong><br><span class="signdesk_dob"></span></td>
                            <td>
                                <div class="verify-btn">
                                    <form method="post" action="{% url 'verify_document' %}" class="verify-form">
                                        {% csrf_token %}
                                        <input type="hidden" name="emp_id" value="">
                                        <input type="hidden" name="doc_type" value="DOB">
                                        <input type="hidden" name="action" value="verify">
                                        <button type="submit" class="yes-btn highlight-btn" style="height: 25px;">Yes</button>
                                    </form>
                                    <button type="button" class="no-btn highlight-btn" data-doc-type="DOB">No</button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><strong class="highlight">Mobile No</strong><br><span class="MobileNo"></span></td>
                            <td><strong class="highlight">Mobile No</strong><br><span class="empmobile"></span></td>
                            <td><strong class="highlight"></strong><br></td>
                            <td>
                                <div class="verify-btn">
                                    <form method="post" action="{% url 'verify_document' %}" class="verify-form">
                                        {% csrf_token %}
                                        <input type="hidden" name="emp_id" value="">
                                        <input type="hidden" name="doc_type" value="MobileNo">
                                        <input type="hidden" name="action" value="verify">
                                        <button type="submit" class="yes-btn highlight-btn" style="height: 25px;">Yes</button>
                                    </form>
                                    <button type="button" class="no-btn highlight-btn" data-doc-type="MobileNo">No</button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><strong class="highlight">Aadhar No</strong><br><span class="adhaarno"></span></td>
                            <td><strong class="highlight">Aadhar No</strong><br></td>
                            <td><strong class="highlight">Aadhar No</strong><br><span class="signdesk_aadharno"></span></td>
                            <td>
                                <div class="verify-btn">
                                    <form method="post" action="{% url 'verify_document' %}" class="verify-form">
                                        {% csrf_token %}
                                        <input type="hidden" name="emp_id" value="">
                                        <input type="hidden" name="doc_type" value="AdhaarNo">
                                        <input type="hidden" name="action" value="verify">
                                        <button type="submit" class="yes-btn highlight-btn" style="height: 25px;">Yes</button>
                                    </form>
                                    <button type="button" class="no-btn highlight-btn" data-doc-type="AdhaarNo">No</button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td><strong class="highlight">PAN No</strong><br><span class="pannumber"></span></td>
                            <td><strong class="highlight">PAN No</strong><br><span class="emppanno"></span></td>
                            <td><strong class="highlight"></strong><br></td>
                            <td>
                                <div class="verify-btn">
                                    <form method="post" action="{% url 'verify_document' %}" class="verify-form">
                                        {% csrf_token %}
                                        <input type="hidden" name="emp_id" value="">
                                        <input type="hidden" name="doc_type" value="PAN_Number">
                                        <input type="hidden" name="action" value="verify">
                                        <button type="submit" class="yes-btn highlight-btn" style="height: 25px;">Yes</button>
                                    </form>
                                    <button type="button" class="no-btn highlight-btn" data-doc-type="PAN_Number">No</button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="documents-container" style="display: flex; flex-wrap: wrap; width: 48%;">
                    <div class="document-box">
                        <img id="AadharProfileImage" src="aadharImage.jpg" onerror="this.onerror=null; this.src='{% static 'image.png' %}';" onclick="zoomImage(this, 'Aadhar Image')" style="height: 70px;">
                        <figcaption>Aadhar Image</figcaption>
                    </div>
                    <div class="document-box">
                        <img id="photoImage" src="photo.jpg" onerror="this.onerror=null; this.src='{% static 'image.png' %}';" onclick="zoomImage(this, 'Photo ID')" style="height: 70px;">
                        <figcaption>Passport Photo</figcaption>
                        <div class="verify-btn">
                            <form method="post" action="{% url 'verify_document' %}" class="verify-form">
                                {% csrf_token %}
                                <input type="hidden" name="emp_id" value="">
                                <input type="hidden" name="doc_type" value="passport_photo">
                                <input type="hidden" name="action" value="verify">
                                <button type="submit" class="yes-btn highlight-btn" style="height: 30px;">Yes</button>
                            </form>
                            <button type="button" class="no-btn highlight-btn" style="height: 30px;" data-doc-type="passport_photo">No</button>
                        </div>
                    </div>
                
                    <div class="document-box">
                        <img id="aadharFrontImage" src="aadhar_front.jpg" onerror="this.onerror=null; this.src='{% static 'image.png' %}';" onclick="zoomImage(this, 'Aadhar Front')" style="height: 70px;">
                        <figcaption>Aadhar Front</figcaption>
                        <div class="verify-btn">
                            <form method="post" action="{% url 'verify_document' %}" class="verify-form">
                                {% csrf_token %}
                                <input type="hidden" name="emp_id" value="">
                                <input type="hidden" name="doc_type" value="aadhaar_front">
                                <input type="hidden" name="action" value="verify">
                                <button type="submit" class="yes-btn highlight-btn" style="height: 30px;">Yes</button>
                            </form>
                            <button type="button" class="no-btn highlight-btn" style="height: 30px;" data-doc-type="aadhaar_front">No</button>
                        </div>
                    </div>
                    <div class="document-box">
                        <img id="aadharBackImage" src="aadhar_back.jpg" onerror="this.onerror=null; this.src='{% static 'image.png' %}';" onclick="zoomImage(this, 'Aadhar Back')" style="height: 70px;">
                        <figcaption>Aadhar Back</figcaption>
                        <div class="verify-btn">
                            <form method="post" action="{% url 'verify_document' %}" class="verify-form">
                                {% csrf_token %}
                                <input type="hidden" name="emp_id" value="">
                                <input type="hidden" name="doc_type" value="aadhaar_back">
                                <input type="hidden" name="action" value="verify">
                                <button type="submit" class="yes-btn highlight-btn" style="height: 30px;">Yes</button>
                            </form>
                            <button type="button" class="no-btn highlight-btn" style="height: 30px;" data-doc-type="aadhaar_back">No</button>
                        </div>                   
                    </div>
                    <div class="document-box">
                        <img id="panImage" src="pan.jpg" onerror="this.onerror=null; this.src='{% static 'image.png' %}';" onclick="zoomImage(this, 'PAN Card')" style="height: 70px;">
                        <figcaption>PAN Card</figcaption>
                        <div class="verify-btn">
                            <form method="post" action="{% url 'verify_document' %}" class="verify-form">
                                {% csrf_token %}
                                <input type="hidden" name="emp_id" value="">
                                <input type="hidden" name="doc_type" value="PAN_Img">
                                <input type="hidden" name="action" value="verify">
                                <button type="submit" class="yes-btn highlight-btn" style="height: 30px;">Yes</button>
                            </form>
                            <button type="button" class="no-btn highlight-btn" style="height: 30px;" data-doc-type="PAN_Img">No</button>
                        </div>                   
                    </div>
                    <div class="document-box">
                        <img id="dlImage" src="dl.jpg" onerror="this.onerror=null; this.src='{% static 'image.png' %}';" onclick="zoomImage(this, 'DL')" style="height: 70px;">
                        <figcaption>DL</figcaption>
                        <div class="verify-btn">
                            <form method="post" action="{% url 'verify_document' %}"  class="verify-form">
                                {% csrf_token %}
                                <input type="hidden" name="emp_id" value="">
                                <input type="hidden" name="doc_type" value="DL_Img">
                                <input type="hidden" name="action" value="verify">
                                <button type="submit" class="yes-btn highlight-btn" style="height: 30px;">Yes</button>
                            </form>
                            <button type="button" class="no-btn highlight-btn" style="height: 30px;" data-doc-type="DL_Img">No</button>
                        </div>                    
                    </div>
                    <div class="document-box">
                        <img id="passbookImage" src="passbook.jpg" onerror="this.onerror=null; this.src='{% static 'image.png' %}';" onclick="zoomImage(this, 'Passbook')" style="height: 70px;">
                        <figcaption>Bank Passbook</figcaption>
                        <div class="verify-btn">
                        <form method="post" action="{% url 'verify_document' %}" class="verify-form">
                                {% csrf_token %}
                                <input type="hidden" name="emp_id" value="">
                                <input type="hidden" name="doc_type" value="Passbook_Img">
                                <input type="hidden" name="action" value="verify">
                                <button type="submit" class="yes-btn highlight-btn" style="height: 30px;">Yes</button>
                            </form>
                            <button type="button" class="no-btn highlight-btn" style="height: 30px;" data-doc-type="Passbook_Img">No</button>
                        </div>                   
                    </div>
                   
                </div>
            </div>
        
        
            <!-- Reject Feedback Modal -->
            <div id="rejectModal" style="display:none; position:fixed; top:30%; left:50%; transform:translate(-50%, -50%); background:white; padding:20px; border:1px solid black; z-index:1000;width: 400px;height: 200px;">
                <h5 id="rejectDocType" style="margin-bottom:10px;">Rejecting Document</h5>
                <textarea id="rejectRemark" placeholder="Enter rejection reason..." rows="5" cols="30" style="border: 1px solid black; width:100%;"></textarea>
                <br><br>
                <button id="submitReject" style="background-color:red; color:white; padding:5px 10px;">Submit</button>
                <button id="cancelReject" style="background-color:gray; color:white; padding:5px 10px;">Cancel</button>
            </div>

            <div id="imageModal" class="modal" style="display: none;">
                <span class="close" onclick="closeZoom()">&times;</span>
                <img class="modal-content" id="zoomedImage">
                <button id="rotateButton" onclick="rotateImage(event)">Rotate</button>
            </div> 
     
            <button id="finalSubmissionBtn" style="margin-top: 20px; padding: 10px 20px; background-color: green; color: white; border: none; cursor: pointer;">
                Final Submission
            </button>
        </div>
        <br>

        <h1 style="text-align:center">Completed Data</h1>
        <br>

        <div class="content-container">
          <div class="table-container">
            <table>
                <thead>
                  <button id="refreshTable">Refresh Table</button>
                    <tr>
                      <th>S/N</th>
                      <th>Emp ID</th>
                      <th>Mobile</th>
                      <th>AADHAR</th>
                      <th>PAN</th>
                      <th>DOB</th>
                      <th>Verify Date</th>

                    </tr>
                </thead>
                <tbody id="completedemployeeTableBody">
                    {% for emp in completed_employee_details %}
                    <tr>
                      <td>{{ forloop.counter }}</td>
                      <td>{{ emp.employee_id }}-{{emp.first_name}}{{emp.surname}}</td>
                      <td>{{ emp.MobileNo }}</td>
                      <td>{{ emp.AdhaarNo }}</td>
                      <td>{{ emp.PAN_Number }}</td>
                      <td>{{ emp.DOB }}</td>
                      <td>{{ emp.Verified_Date }}</td>
                    </tr>
                    {% endfor %} 

                </tbody>
            </table>
        </div>

    </div>
    <h1 style="text-align:center">Rejected Data</h1>
    <div class="content-container">
        <div class="table-container">
            <table>
                <thead>
                  <button id="refreshTable">Refresh Table</button>
                    <tr>
                        <th>S/No.</th>
                        <th>Emp ID</th>
                        <th>Mobile</th>
                        <th>AADHAR</th>
                        <th>PAN</th>
                        <th>DOB</th>
                        <th>Verified Date</th>
                    </tr>
                </thead>
                <tbody id="completedemployeeTableBody">
                    {% for emp in reject_employee_details %}
                    <tr>
                        <td>{{ forloop.counter }}</td> 
                        <td>{{ emp.employee_id }}-{{emp.first_name}}{{emp.surname}}</td>
                        <td>{{ emp.MobileNo }}</td>
                        <td>{{ emp.AdhaarNo }}</td>
                        <td>{{ emp.PAN_Number }}</td>
                        <td>{{ emp.DOB }}</td>
                        <td>{{ emp.Verified_Date }}</td>

                    </tr>
                    {% endfor %} 
                  
                </tbody>
            </table>
        </div>
    </div>

  </div>



{% comment %} final Submission {% endcomment %}
<script>
    $(document).ready(function () {
        var selectedEmpId = null; // Global variable to store selected emp_id

        // Handle row click to select employee
        $(document).on("click", ".employee-row", function () {
            selectedEmpId = $(this).data("id"); // Get emp_id from the clicked row
            console.log("Selected Emp ID:", selectedEmpId); // Debugging: Log selected emp_id

            // Highlight the selected row
            $(".employee-row").css("background-color", ""); // Reset all rows
            $(this).css("background-color", "#94d994"); // Highlight selected row (Light Green)
        });
        // Final Submission Button Click
        $("#finalSubmissionBtn").on("click", function () {
            if (!selectedEmpId) {
                alert("Please select an employee first!");
                return;
            }

            // AJAX request to check and update isProcessed
            $.ajax({
                url: "/final-submission/", // Backend API endpoint
                type: "POST",
                data: {
                    emp_id: selectedEmpId, // Pass the selected emp_id
                    csrfmiddlewaretoken: "{{ csrf_token }}" // CSRF token for security
                },
                success: function (response) {
                    if (response.status === "success") {
                        alert("Final submission successful!");
                        location.reload(); // Reload the page after success
                    } else if (response.status === "error") {
                        alert(response.message); // Show the error message
                    }
                },
                error: function (xhr, status, error) {
                    console.log("Error:", error); // Debug error
                    console.log("Response Text:", xhr.responseText); // Debug response text
                    alert("An error occurred during final submission!");
                }
            });
        });
    });
</script>


  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <script>
    $(document).ready(function () {
        // Ensure loader is hidden when the page loads
        $("#overlay-loader").hide();
    
        function showLoader() {
            $("#overlay-loader").show();
        }
    
        function hideLoader() {
            $("#overlay-loader").hide();
        }
    
        // Handle the "Yes" button click
        $(".verify-form").submit(function (event) {
            event.preventDefault(); // Prevent page reload
            showLoader(); // Show loader
            
            var form = $(this);
            var formData = form.serialize(); // Serialize form data
            var btn = form.find("button"); // Find the button inside the form
            var docType = form.find("input[name='doc_type']").val(); // Get the document type

            $.ajax({
                url: form.attr("action"),
                type: "POST",
                data: formData,
                headers: { "X-CSRFToken": "{{ csrf_token }}" }, // CSRF protection
                success: function (response) {
                    hideLoader(); // Hide loader after response
                    
                    if (response.status === "success") {
                        var parentTd = form.closest("td");
                        parentTd.find("button").removeClass("highlight-yes highlight-no"); // Reset all buttons
    
                        if (form.find("input[name='action']").val() === "verify") {
                            btn.addClass("highlight-yes"); // Highlight "Yes" button in green
                            
                            // Remove highlight from the "No" button
                            var noButton = $(`button[data-doc-type='${docType}']`).closest(".verify-btn").find(".no-btn");
                            noButton.removeClass("highlight-no");
                            
                            alert("Verification successful");
                        } else {
                            btn.addClass("highlight-no"); // Highlight "No" button in red
                        }
                    } else {
                        alert("Verification failed: " + response.message);
                    }
                },
                error: function () {
                    hideLoader(); // Hide loader if error occurs
                    alert("Error in verification request!");
                },
            });
        });
    
        // Handle the "No" button click to open the modal
        $(document).on("click", ".no-btn", function () {
            var empId = $("input[name='emp_id']").val();
            var docType = $(this).data("doc-type"); // Get the document type
    
            // Store the empId and docType in the modal for later use
            $("#rejectModal").data("emp-id", empId);
            $("#rejectModal").data("doc-type", docType);
            
          
            // Show the modal
            $("#rejectModal").show();
        });
    
        // Handle the "Cancel" button in the modal
        $("#cancelReject").on("click", function () {
            $("#rejectModal").hide(); // Hide the modal
            $("#rejectRemark").val(""); // Clear the remark field
        });
    
        // Handle the "Submit" button in the modal
        $("#submitReject").on("click", function () {
            var empId = $("#rejectModal").data("emp-id");
            var docType = $("#rejectModal").data("doc-type");
            var remark = $("#rejectRemark").val();
    
            if (!remark) {
                alert("Please provide a rejection reason.");
                return;
            }
    
            showLoader(); // Show loader
    
            // Send the rejection data to the server
            $.ajax({
                url: "/verify-document/",
                type: "POST",
                data: {
                    emp_id: empId,
                    doc_type: docType,
                    action: "reject",
                    remark: remark,
                    csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val() // CSRF token
                },
                success: function (response) {
                    hideLoader(); // Hide loader after response
                    
                    if (response.status === "success") {
                        alert("Document rejected successfully!");
                        $("#rejectModal").hide(); // Hide the modal
                        $("#rejectRemark").val(""); // Clear the remark field
                        
                        // Remove highlight from "Yes" button
                        var yesButton = $(`button[data-doc-type='${docType}']`).closest(".verify-btn").find(".yes-btn");
                        yesButton.removeClass("highlight-yes");

                        // Highlight the "No" button in red
                        var noButton = $(`button[data-doc-type='${docType}']`);
                        noButton.addClass("highlight-no");

                    } else {
                        alert("Error: " + response.message);
                    }
                },
                error: function () {
                    hideLoader(); // Hide loader if error occurs
                    alert("Error in rejection request!");
                },
            });
        });
    });
</script>





<script>
    function runStoredProcedure() {
        fetch('/run-sp/', { method: 'GET' })
        .catch(error => console.error('Error:', error));
    }
</script>



<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>

  $(document).ready(function () {
    // ðŸ”¹ Step 1: Load Employee List
    $("#unit").change(function () {
        var unitid = $(this).val();
        if (unitid) {
            $.ajax({
                url: "/get-emp/",
                type: "GET",
                data: { unitid: unitid },
                dataType: "json",
                success: function (response) {
                    $("#pendingemployeeTableBody").empty();
                    var employees = response.employee_details;

                    if (employees.length === 0) {
                        $("#pendingemployeeTableBody").append("<tr><td colspan='6'>No employees found</td></tr>");
                    } else {
                        $.each(employees, function (index, emp) {
                            $("#pendingemployeeTableBody").append(
                                "<tr class='employee-row' data-id='" + emp.EmpID + "'>" +
                                "<td>" + emp.EmpID + "</td>" +
                                "<td>" + emp.MobileNo + "</td>" +
                                "<td>" + emp.AdhaarNo + "</td>" +
                                "<td>" + emp.PAN_Number + "</td>" +
                                "<td>" + emp.DOB + "</td>" +
                                "<td>" +
                                "<button class='yes-btn' data-id='" + emp.EmpID + "'>Yes</button> " +
                                "<button class='no-btn' data-id='" + emp.EmpID + "'>No</button>" +
                                "</td>" +
                                "</tr>"
                            );
                        });
                    }
                },
                error: function (xhr, status, error) {
                    console.log("Error:", error);
                }
            });
        }
    });

     // ðŸ”¹ Step 2: Fetch Images on Row Click
     $(document).on("click", ".employee-row", function () {
      var empid = $(this).data("id");
    
      // ðŸ”¹ Remove highlight from other rows and add to the clicked row
      $(".employee-row").css("background-color", ""); // Reset all rows
      $(this).css("background-color", "#94d994"); // Highlight selected row (Light Green)

      $(".yes-btn").removeClass("highlight-yes");
      $(".no-btn").removeClass("highlight-no");
      
      $.ajax({
          url: "/get-emp-images/",
          type: "GET",
          data: { empid: empid },
          dataType: "json",
          success: function (response) {
              if (response.error) {
                  alert(response.error);
              } else {
                 // Update the forms with the selected emp_id
                $("input[name='emp_id']").val(empid);
                // Basic Details
                $(".zonename").text(response.Zone); 
                $(".divisionname").text(response.DivisionName); // Division Name
                $(".regionname").text(response.RegionName); // Region Name
                $(".unitname").text(response.UnitName); // Unit Name

                var fullName = (response.first_name ? response.first_name : "") + " " + (response.surname ? response.surname : "");
                $(".staffname").text(fullName.trim()); // Display Full Name

                $(".staffid").text(response.StaffID); // Employee ID 
                $(".empmobile").text(response.EmpMobileNo); // Mobile Number
                $(".MobileNo").text(response.MobileNo); // Mobile Number

                // âœ… Remove time from DOJ (format: YYYY-MM-DD)
                var dojDate = response.DOJ ? response.DOJ.split("T")[0] : "";
                $(".doj").text(dojDate); // Display Date Only (YYYY-MM-DD)

                var dobDate = response.EmpDOB ? response.EmpDOB.split("T")[0] : "";
                $(".empdob").text(dobDate); // Employee DOB 

                $(".dob").text(response.DOB); // User Input DOB 
                $(".signdesk_dob").text(response.DOB_Signdesk);

                $(".adhaarno").text(response.AdhaarNo); // User Input Aadhar number 
                $(".signdesk_aadharno").text(response.AadharNo_Signdesk);

                $(".pannumber").text(response.PAN_Number); // User Input PAN number 
                $(".emppanno").text(response.EmpPanNo); // User Input PAN number 

                $(".signdesk_name").text(response.FullName_Signdesk);
                $(".care_of").text(response.Care_of);
                $(".district").text(response.District);
                $(".house_no").text(response.House);


                // images
                $("#photoImage").attr("src", response.Photo ? response.Photo : "");                
                $("#aadharFrontImage").attr("src", response.AdhaarFrontImg ? response.AdhaarFrontImg : "");
                $("#aadharBackImage").attr("src", response.AdhaarBackImg ? response.AdhaarBackImg : "");
                $("#panImage").attr("src", response.PAN_Img ? response.PAN_Img : "");
                $("#dlImage").attr("src", response.DL_Img ? response.DL_Img : "");
                $("#passbookImage").attr("src", response.Passbook_Img ? response.Passbook_Img : "");

                $("#AadharProfileImage").attr("src", response.ProfileImage ? response.ProfileImage : "");

              }
          },
          error: function (xhr, status, error) {
              console.log("Error:", error);
          }
      });
  });

  });

</script>  

<script>
    let rotationAngle = 0;
    let zoomScale = 1;

    function rotateImage(event) {
        event.stopPropagation(); // Prevent modal from closing
        rotationAngle += 90;
        document.getElementById("zoomedImage").style.transform = `rotate(${rotationAngle}deg) scale(${zoomScale})`;
    }

    function closeZoom() {
        document.getElementById("imageModal").style.display = "none";
        rotationAngle = 0;
        zoomScale = 1;
        document.getElementById("zoomedImage").style.transform = "rotate(0deg) scale(1)";
    }

    function zoomImage(image) {
        document.getElementById("zoomedImage").src = image.src;
        document.getElementById("imageModal").style.display = "flex";
    }

    // Ensure modal only opens on image click
    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("imageModal").style.display = "none";
    });

    // Close modal only if clicking outside the image
    document.getElementById("imageModal").addEventListener("click", function(event) {
        if (event.target === this) {
            closeZoom();
        }
    });

    // Zoom in and out using mouse scroll
    document.getElementById("zoomedImage").addEventListener("wheel", function(event) {
        event.preventDefault();
        if (event.deltaY < 0) {
            zoomScale += 0.1; // Zoom in
        } else {
            zoomScale = Math.max(1, zoomScale - 0.1); // Zoom out (minimum scale 1)
        }
        this.style.transform = `rotate(${rotationAngle}deg) scale(${zoomScale})`;
    });

    // Pinch-to-zoom support for touch devices
    let touchStartDistance = 0;

    function getTouchDistance(event) {
        let dx = event.touches[0].clientX - event.touches[1].clientX;
        let dy = event.touches[0].clientY - event.touches[1].clientY;
        return Math.sqrt(dx * dx + dy * dy);
    }

    document.getElementById("zoomedImage").addEventListener("touchstart", function(event) {
        if (event.touches.length === 2) {
            touchStartDistance = getTouchDistance(event);
        }
    });

    document.getElementById("zoomedImage").addEventListener("touchmove", function(event) {
        if (event.touches.length === 2) {
            event.preventDefault();
            let newDistance = getTouchDistance(event);
            if (newDistance > touchStartDistance) {
                zoomScale += 0.05; // Zoom in
            } else {
                zoomScale = Math.max(1, zoomScale - 0.05); // Zoom out (minimum scale 1)
            }
            this.style.transform = `rotate(${rotationAngle}deg) scale(${zoomScale})`;
            touchStartDistance = newDistance;
        }
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const rows = document.querySelectorAll(".employee-row");
        const loader = document.getElementById("overlay-loader");
    
        // Ensure loader is hidden when page loads
        loader.style.display = "none";
    
        rows.forEach(row => {
            row.addEventListener("click", function () {
                loader.style.display = "flex";  // Show loader only on click
    
                const empId = this.getAttribute("data-id");
    
                // Fake delay for testing (Replace with actual fetch call)
                setTimeout(() => {
                    console.log("Fetching data for Employee ID:", empId);
    
                    // Hide loader after fetching data
                    loader.style.display = "none";
                }, 2000);
            });
        });
    });
    
</script>

<script>
    $(document).on("click", ".employee-row", function () {
        var empId =   $(this).data("id"); // Get the selected employee ID
    
        // Highlight the selected row
        $(".employee-row").css("background-color", ""); // Reset all rows
        $(this).css("background-color", "#94d994"); // Highlight selected row (Light Green)
    
        // Reset all button highlights
        $(".yes-btn").removeClass("highlight-yes");
        $(".no-btn").removeClass("highlight-no");
    
        // Fetch verification status for the selected employee
        $.ajax({
            url: "/get_verification_status/", // Backend API endpoint
            type: "GET",
            data: { emp_id: empId }, // Pass the selected employee ID
            success: function (response) {
                if (response.status === "success") {
                    var verificationData = response.data;
    
                    // Update button highlights based on verification status
                    for (var docType in verificationData) {
                        var status = verificationData[docType];
                        var yesButton = $(`button[data-doc-type='${docType}']`).closest(".verify-btn").find(".yes-btn");
                        var noButton = $(`button[data-doc-type='${docType}']`).closest(".verify-btn").find(".no-btn");
    
                        if (status === "verified") {
                            yesButton.addClass("highlight-yes"); // Highlight "Yes" button in green
                            noButton.removeClass("highlight-no"); // Remove "No" highlight
                        } else if (status === "rejected") {
                            noButton.addClass("highlight-no"); // Highlight "No" button in red
                            yesButton.removeClass("highlight-yes"); // Remove "Yes" highlight
                        }
                    }
                } else {
                    alert("Error fetching verification status: " + response.message);
                }
            },
            error: function () {
                alert("Error fetching verification status!");
            }
        });
    });
    </script>

</body>
</html>
